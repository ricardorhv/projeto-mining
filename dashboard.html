<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Previsão do Preço do Milho</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Plotly.js (Biblioteca de Gráficos) -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* Fonte Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* cinza claro de fundo */
        }
        .card {
            background-color: white;
            border-radius: 0.75rem; /* bordas arredondadas */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem; /* 24px */
            transition: all 0.3s ease-in-out;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .kpi-title {
            font-size: 0.875rem; /* 14px */
            font-weight: 500;
            color: #4b5563; /* cinza 600 */
            text-transform: uppercase;
        }
        .kpi-value {
            font-size: 2.25rem; /* 36px */
            font-weight: 700;
            color: #1f2937; /* cinza 800 */
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Cabeçalho -->
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800">Dashboard de Previsão do Preço do Milho</h1>
            <p class="text-xl text-gray-600 mt-2">Análise de dados históricos, climáticos e econômicos para prever o valor da saca.</p>
        </header>

        <!-- Seção de KPIs (Indicadores) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="card items-center justify-center text-center">
                <h3 class="kpi-title">Último Preço (R$)</h3>
                <p id="kpi-ultimo-preco" class="kpi-value text-blue-600">R$ 0,00</p>
                <span id="kpi-ultimo-preco-data" class="text-sm text-gray-500"></span>
            </div>
            <div class="card items-center justify-center text-center">
                <h3 class="kpi-title">Preço Médio (R$)</h3>
                <p id="kpi-preco-medio" class="kpi-value text-blue-600">R$ 0,00</p>
                <span class="text-sm text-gray-500">Período total</span>
            </div>
            <div class="card items-center justify-center text-center">
                <h3 class="kpi-title">Taxa de Dólar Média</h3>
                <p id="kpi-dolar-medio" class="kpi-value text-green-600">0.00</p>
                <span class="text-sm text-gray-500">Período total</span>
            </div>
            <div class="card items-center justify-center text-center">
                <h3 class="kpi-title">Chuva Média Mensal (MT)</h3>
                <p id="kpi-chuva-media" class="kpi-value text-cyan-600">0 mm</p>
                <span class="text-sm text-gray-500">Sinop + Sorriso</span>
            </div>
        </div>

        <!-- Seção Principal de Gráficos -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Coluna da Esquerda (Resultados do Modelo) -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Card: Previsão vs Real -->
                <div class="card">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">Resultado do Modelo: Previsão (Vermelho) vs. Real (Azul)</h2>
                    <p class="text-sm text-gray-600 mb-4">
                        Este gráfico mostra o desempenho do nosso modelo nos dados de teste. A linha azul é o preço real, e a linha vermelha tracejada é o que o modelo previu.
                    </p>
                    <img src="grafico_previsao_vs_real.png" alt="Gráfico de Previsão vs. Real" class="w-full h-auto rounded-lg shadow-md"
                         onerror="this.alt='Erro: Imagem \'grafico_previsao_vs_real.png\' não encontrada. Certifique-se que ela está na mesma pasta do dashboard.'; this.src='https://placehold.co/800x400/ef4444/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                </div>
                
                <!-- Card: Importância das Features -->
                <div class="card">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">O que mais importa para o Modelo?</h2>
                    <p class="text-sm text-gray-600 mb-4">
                        Este gráfico mostra quais variáveis (features) o modelo considerou mais importantes para fazer suas previsões.
                    </p>
                    <img src="grafico_importancia_features.png" alt="Gráfico de Importância das Features" class="w-full h-auto rounded-lg shadow-md"
                         onerror="this.alt='Erro: Imagem \'grafico_importancia_features.png\' não encontrada.'; this.src='https://placehold.co/800x600/ef4444/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                </div>
            </div>

            <!-- Coluna da Direita (Gráficos Interativos) -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Card: Correlação -->
                <div class="card">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">Correlação Geral das Variáveis</h2>
                    <img src="grafico_master_correlacao.png" alt="Mapa de Calor de Correlação" class="w-full h-auto rounded-lg shadow-md"
                         onerror="this.alt='Erro: Imagem \'grafico_master_correlacao.png\' não encontrada.'; this.src='https://placehold.co/400x300/ef4444/ffffff?text=Imagem+N%C3%A3o+Encontrada';">
                </div>

                <!-- Card: Série Temporal do Dólar -->
                <div class="card">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">Série Temporal: Taxa de Dólar</h2>
                    <div id="plot-dolar" class="w-full h-64"></div>
                </div>

                <!-- Card: Relação Estoque/Uso -->
                <div class="card">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">Série Temporal: Estoque/Uso</h2>
                    <div id="plot-estoque" class="w-full h-64"></div>
                </div>
            </div>

        </div>

        <!-- Seção de Gráficos de Exploração -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <!-- Card: Série Temporal Preço R$ -->
            <div class="card">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">Série Temporal Interativa: Preço (R$)</h2>
                <div id="plot-preco" class="w-full h-96"></div>
            </div>

            <!-- Card: Chuva Mensal -->
            <div class="card">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">Chuva Mensal Acumulada (Sinop e Sorriso)</h2>
                <div id="plot-chuva" class="w-full h-96"></div>
            </div>
        </div>

    </div>

    <!-- Script para processar dados e criar gráficos -->
    <script>
        // --- INSTRUÇÃO IMPORTANTE ---
        // 1. Abra o arquivo 'master_dataframe_mensal.csv'
        // 2. Copie TODO o conteúdo (Ctrl+A, Ctrl+C)
        // 3. Cole o conteúdo entre as `crases` abaixo, substituindo este texto.
        const dados_csv_colados_aqui = `
Data,Preco_R,Preco_US,Precipitacao_Sinop,Precipitacao_Sorriso,Temperatura_Sinop,Temperatura_Sorriso,Relacao_Estoque_Uso,Taxa_Dolar,Preco_R_Lag1
2019-01-01,38.907272727272726,10.412727272727272,201.0,265.6,25.275672043010754,25.765591397849462,0.15024491693880537,3.7365112624410686,37.82611111111111
2019-02-01,40.8935,10.989,120.0,409.4,25.31815476190476,25.710416666666667,0.15024491693880537,3.721312221312221,38.907272727272726
2019-03-01,39.823157894736845,10.364210526315789,166.8,322.8,25.236290322580647,25.700806451612905,0.15024491693880537,3.8423725370708923,40.8935
2019-04-01,36.422380952380955,9.355238095238096,201.20000000000002,181.6,25.73611111111111,26.050833333333333,0.15024491693880537,3.8932607146492924,39.823157894736845
2019-05-01,34.837272727272726,8.718181818181819,11.6,11.6,27.12728494623656,29.28548387096774,0.15024491693880537,3.9959332638164753,36.422380952380955
2019-06-01,38.03631578947368,9.852631578947367,0.0,0.0,31.33972222222222,30.3,0.15024491693880537,3.860523504273505,34.837272727272726
2019-07-01,37.095652173913045,9.815652173913042,0.2,0.8,31.578897849462365,30.11451612903226,0.15024491693880537,3.7792345854004257,38.03631578947368
2019-08-01,36.412727272727274,9.05181818181818,0.4,0.0,26.57701612903226,27.228629032258063,0.15024491693880537,4.022697599678619,37.095652173913045
2019-09-01,37.6447619047619,9.12904761904762,10.2,34.8,28.425277777777776,29.214722222222225,0.15024491693880537,4.1236242240884655,36.412727272727274
2019-10-01,41.50826086956521,10.168260869565218,254.0,191.2,25.991129032258065,26.654838709677417,0.15024491693880537,4.082139650233034,37.6447619047619
2019-11-01,44.542,10.708,246.0,268.4,25.63,26.12236111111111,0.15024491693880537,4.159693686963019,41.50826086956521
2019-12-01,48.159473684210525,11.716842105263158,257.2,442.40000000000003,25.158870967741933,25.74301075268817,0.15024491693880537,4.110277603090468,44.542
2020-01-01,51.07454545454546,12.306818181818182,193.4,201.0,25.360887096774192,25.967876344086022,0.1469303022479292,4.150101569713758,48.159473684210525
2020-02-01,51.69111111111111,11.893888888888888,0.0,211.0,25.45301724137931,25.974999999999998,0.1469303022479292,4.346022700733337,51.07454545454546
2020-03-01,57.41227272727272,11.732272727272727,0.0,133.4,25.42822580645161,25.968010752688173,0.1469303022479292,4.893533764673975,51.69111111111111
2020-04-01,52.920500000000004,9.9525,55.0,208.79999999999998,25.44611111111111,26.02263888888889,0.1469303022479292,5.317307209243909,57.41227272727272
2020-05-01,50.116499999999995,8.8975,7.6000000000000005,35.2,24.56075268817204,24.815725806451614,0.1469303022479292,5.632649620679965,52.920500000000004
2020-06-01,47.7552380952381,9.194285714285716,0.0,0.0,25.674444444444443,25.949583333333333,0.1469303022479292,5.194012844416822,50.116499999999995
2020-07-01,49.699999999999996,9.415652173913044,0.0,0.0,21.837096774193554,25.95282258064516,0.1469303022479292,5.27844477281123,47.7552380952381
2020-08-01,56.62047619047619,10.364285714285714,0.0,0.0,21.600000000000005,27.08736559139785,0.1469303022479292,5.463036985986676,49.699999999999996
2020-09-01,60.058571428571426,11.117619047619048,0.0,0.0,21.600000000000005,36.196527777777774,0.1469303022479292,5.402107337131109,56.62047619047619
2020-10-01,72.71428571428571,12.911428571428571,0.0,0.0,21.600000000000005,36.4,0.1469303022479292,5.6317769418012835,60.058571428571426
2020-11-01,80.313,14.815999999999999,0.0,0.0,21.600000000000005,36.4,0.1469303022479292,5.420693844492441,72.71428571428571
2020-12-01,75.3345,14.6525,0.0,0.0,21.600000000000005,36.4,0.1469303022479292,5.141409315816414,80.313
2022-10-01,84.525,16.104499999999998,54.6,70.0,26.28558201058201,25.658863636363638,0.05370084277247883,5.248533018721476,84.0552380952381
2022-11-01,84.99300000000001,16.0955,180.20000000000002,109.2,25.63361111111111,26.114444444444448,0.05370084277247883,5.280544251498866,84.525
2022-12-01,86.01190476190476,16.376190476190477,349.8,353.6,24.190725806451614,24.58266129032258,0.05370084277247883,5.252253562082,84.99300000000001
2023-01-01,86.10545454545455,16.58090909090909,326.0,352.2,24.184408602150537,24.3122311827957,0.015381705622781412,5.193047864466255,86.01190476190476
2023-02-01,85.74444444444445,16.557777777777776,285.2,349.59999999999997,25.101190476190478,25.767857142857142,0.015381705622781412,5.1784995302643955,86.10545454545455
2023-03-01,84.8808695652174,16.30913043478261,294.8,291.8,24.7380376344086,25.00712365591398,0.015381705622781412,5.204500013329423,85.74444444444445
2023-04-01,74.85222222222222,14.91888888888889,0.0,99.4,25.261527777777776,25.85111111111111,0.015381705622781412,5.017278617710582,84.8808695652174
2023-05-01,58.16045454545454,11.67681818181818,0.0,0.2,25.526344086021506,26.39502688172043,0.015381705622781412,4.980847833703142,74.85222222222222
2023-06-01,55.039047619047615,11.365238095238096,0.0,76.19999999999999,24.850833333333334,24.98375,0.015381705622781412,4.842753592826915,58.16045454545454
2023-07-01,54.9752380952381,11.450952380952382,0.0,0.0,25.79959677419355,26.19448924731183,0.015381705622781412,4.800931509127958,55.039047619047615
2023-08-01,53.34478260869565,10.879130434782608,0.0,25.8,27.815994623655914,28.236559139784948,0.015381705622781412,4.903405003596835,54.9752380952381
2023-09-01,54.625,11.044500000000001,0.0,44.0,28.79375,29.330972222222222,0.015381705622781412,4.94590067454389,53.34478260869565
2023-10-01,59.13333333333333,11.675714285714285,0.0,143.0,28.258870967741935,28.91975806451613,0.015381705622781412,5.0646437456666265,54.625
2023-11-01,60.647000000000006,12.382000000000001,0.0,104.2,27.295277777777777,27.824166666666667,0.015381705622781412,4.897997092553707,59.13333333333333
2023-12-01,66.77105263157895,13.627368421052632,0.0,204.2,26.444220430107528,27.23467741935484,0.015381705622781412,4.8997759925845825,60.647000000000006
2024-01-01,65.82863636363636,13.394545454545455,0.0,541.6,25.63736559139785,26.185887096774195,0.10813738552958062,4.91458531288177,66.77105263157895
2024-02-01,62.57947368421053,12.612105263157895,0.0,490.6,25.949281609195403,26.39109195402299,0.10813738552958062,4.961857864207319,65.82863636363636
2024-03-01,62.719500000000004,12.5985,337.2,397.8,26.188575268817203,26.599596774193547,0.10813738552958062,4.978330753661151,62.57947368421053
2024-04-01,59.63136363636364,11.637727272727272,169.2,195.6,26.295416666666664,26.9125,0.10813738552958062,5.123969847283522,62.719500000000004
2024-05-01,58.924285714285716,11.471904761904762,0.0,0.6000000000000001,25.704166666666666,26.206720430107527,0.10813738552958062,5.1363994852849615,59.63136363636364
2024-06-01,57.8605,10.730500000000001,0.0,0.0,26.008333333333333,26.52652777777778,0.10813738552958062,5.3921532081450065,58.924285714285716
2024-07-01,57.21826086956521,10.316521739130435,0.0,0.0,25.29811827956989,25.68037634408602,0.10813738552958062,5.546274443695212,57.8605
2024-08-01,59.57636363636364,10.731818181818182,0.0,0.0,27.14489247311828,27.414516129032258,0.10813738552958062,5.55137653536637,57.21826086956521
2024-09-01,62.59952380952382,11.301904761904762,36.599999999999994,23.4,28.591527777777777,29.815833333333334,0.10813738552958062,5.538847223392602,59.57636363636364
2024-10-01,68.78782608695651,12.223478260869564,193.6,191.0,27.291263440860217,28.475,0.10813738552958062,5.627516539802234,62.59952380952382
2024-11-01,73.67526315789473,12.69578947368421,165.0,359.6,25.459305555555556,25.69847222222222,0.10813738552958062,5.803125777298732,68.78782608695651
2024-12-01,72.91789473684211,11.964210526315789,4.4,251.60000000000002,25.267876344086023,25.593413978494624,0.10813738552958062,6.094668308991731,73.67526315789473

`;

        // --- Fim da Instrução ---


        // Função principal para iniciar o dashboard
        document.addEventListener('DOMContentLoaded', () => {
            if (dados_csv_colados_aqui.trim().startsWith('COLE OS DADOS')) {
                alert('DASHBOARD NÃO INICIADO!\n\nPor favor, edite o arquivo "dashboard.html", encontre a variável "dados_csv_colados_aqui" e cole o conteúdo do seu arquivo "master_dataframe_mensal.csv" lá.');
                return;
            }
            
            // Processa o CSV colado
            const dados = processarCSV(dados_csv_colados_aqui);
            
            // Atualiza os KPIs
            atualizarKPIs(dados);

            // Cria os gráficos interativos
            plotarGraficoPreco(dados);
            plotarGraficoDolar(dados);
            plotarGraficoChuva(dados);
            plotarGraficoEstoque(dados);
        });

        /**
         * Converte o texto CSV em um array de objetos.
         */
        function processarCSV(csvText) {
            const linhas = csvText.trim().split('\n');
            const cabecalho = linhas[0].split(',');
            
            const dados = linhas.slice(1).map(linha => {
                const valores = linha.split(',');
                let obj = {};
                cabecalho.forEach((col, index) => {
                    let valor = valores[index];
                    // Converte para número se não for a Data
                    if (col !== 'Data') {
                        obj[col] = parseFloat(valor);
                    } else {
                        obj[col] = valor; // Mantém a data como string por enquanto
                    }
                });
                return obj;
            });
            
            // Converte datas para objetos Date (necessário para Plotly)
            dados.forEach(d => {
                d.DataObj = new Date(d.Data);
            });
            
            return dados;
        }

        /**
         * Atualiza os cards de KPI no topo da página.
         */
        function atualizarKPIs(dados) {
            if (dados.length === 0) return;

            // Último preço
            const ultimoDado = dados[dados.length - 1];
            document.getElementById('kpi-ultimo-preco').textContent = `R$ ${ultimoDado.Preco_R.toFixed(2)}`;
            document.getElementById('kpi-ultimo-preco-data').textContent = `em ${new Date(ultimoDado.DataObj).toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' })}`;

            // Médias
            const somaPreco = dados.reduce((acc, d) => acc + d.Preco_R, 0);
            const somaDolar = dados.reduce((acc, d) => acc + d.Taxa_Dolar, 0);
            const somaChuva = dados.reduce((acc, d) => acc + d.Precipitacao_Sinop + d.Precipitacao_Sorriso, 0);

            document.getElementById('kpi-preco-medio').textContent = `R$ ${(somaPreco / dados.length).toFixed(2)}`;
            document.getElementById('kpi-dolar-medio').textContent = `${(somaDolar / dados.length).toFixed(2)}`;
            document.getElementById('kpi-chuva-media').textContent = `${((somaChuva / dados.length) / 2).toFixed(0)} mm`; // Média por estação
        }

        // Configuração padrão de layout do Plotly
        const plotlyLayout = {
            autosize: true,
            margin: { l: 40, r: 20, t: 20, b: 40 },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            xaxis: {
                gridcolor: '#e5e7eb' // cinza 200
            },
            yaxis: {
                gridcolor: '#e5e7eb' // cinza 200
            },
            legend: {
                orientation: 'h',
                yanchor: 'bottom',
                y: 1.02,
                xanchor: 'right',
                x: 1
            }
        };

        /**
         * Plota o gráfico de Preço (R$) ao longo do tempo.
         */
        function plotarGraficoPreco(dados) {
            const trace = {
                x: dados.map(d => d.DataObj),
                y: dados.map(d => d.Preco_R),
                type: 'scatter',
                mode: 'lines',
                name: 'Preço (R$)',
                line: { color: '#2563eb' } // azul 600
            };
            Plotly.newPlot('plot-preco', [trace], { ...plotlyLayout, yaxis: { ...plotlyLayout.yaxis, title: 'R$/Saca' } });
        }

        /**
         * Plota o gráfico da Taxa de Dólar ao longo do tempo.
         */
        function plotarGraficoDolar(dados) {
            const trace = {
                x: dados.map(d => d.DataObj),
                y: dados.map(d => d.Taxa_Dolar),
                type: 'scatter',
                mode: 'lines',
                name: 'Dólar (R$)',
                line: { color: '#16a34a' } // verde 600
            };
            Plotly.newPlot('plot-dolar', [trace], { ...plotlyLayout, yaxis: { ...plotlyLayout.yaxis, title: 'Taxa (R$)' } });
        }
        
        /**
         * Plota o gráfico de Relação Estoque/Uso ao longo do tempo.
         */
        function plotarGraficoEstoque(dados) {
            const trace = {
                x: dados.map(d => d.DataObj),
                y: dados.map(d => d.Relacao_Estoque_Uso),
                type: 'scatter',
                mode: 'lines',
                name: 'Estoque/Uso',
                line: { color: '#d97706' } // amber 600
            };
            Plotly.newPlot('plot-estoque', [trace], { ...plotlyLayout, yaxis: { ...plotlyLayout.yaxis, title: 'Índice' } });
        }

        /**
         * Plota o gráfico de Chuva Mensal (Barras).
         */
        function plotarGraficoChuva(dados) {
            const traceSinop = {
                x: dados.map(d => d.DataObj),
                y: dados.map(d => d.Precipitacao_Sinop),
                type: 'bar',
                name: 'Chuva Sinop (mm)',
                marker: { color: '#0891b2' } // cyan 600
            };
            const traceSorriso = {
                x: dados.map(d => d.DataObj),
                y: dados.map(d => d.Precipitacao_Sorriso),
                type: 'bar',
                name: 'Chuva Sorriso (mm)',
                marker: { color: '#0d9488' } // teal 600
            };

            const layoutChuva = { ...plotlyLayout, barmode: 'stack', yaxis: { ...plotlyLayout.yaxis, title: 'Precipitação (mm)' } };
            Plotly.newPlot('plot-chuva', [traceSinop, traceSorriso], layoutChuva);
        }

    </script>
</body>
</html>
